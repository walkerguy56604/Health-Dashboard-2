import json
import matplotlib.pyplot as plt

# Load JSON data
with open("daily_activity_log.json", "r") as f:
    data = json.load(f)

# Extract data
times = []
systolic = []
diastolic = []
heart_rate = []
glucose = []
weight = []
highlights = []

for entry in data["entries"]:
    times.append(entry["time"])
    systolic.append(entry.get("systolic", None))
    diastolic.append(entry.get("diastolic", None))
    heart_rate.append(entry.get("heart_rate", None))
    glucose.append(entry.get("glucose", None))
    weight.append(entry.get("weight", None))
    
    # Highlight post-strength and post-walk readings
    if entry.get("event") in ["after_strength", "after_walk"]:
        highlights.append(True)
    else:
        highlights.append(False)

# Create figure and axes
fig, ax1 = plt.subplots(figsize=(14,7))

# Blood pressure
ax1.plot(times, systolic, label="Systolic BP", marker='o', color='blue')
ax1.plot(times, diastolic, label="Diastolic BP", marker='o', color='red')
ax1.set_xlabel("Time")
ax1.set_ylabel("BP (mmHg)")
ax1.tick_params(axis='y')

# Highlight post-strength and post-walk BP
for i, highlight in enumerate(highlights):
    if highlight:
        ax1.scatter(times[i], systolic[i], s=200, facecolors='none', edgecolors='orange', linewidths=2)
        ax1.scatter(times[i], diastolic[i], s=200, facecolors='none', edgecolors='orange', linewidths=2)

# Heart rate on secondary y-axis
ax2 = ax1.twinx()
ax2.plot(times, heart_rate, label="Heart Rate", marker='x', linestyle='--', color='green')
ax2.set_ylabel("Heart Rate (bpm)")
ax2.tick_params(axis='y', labelcolor='green')

# Glucose and weight on tertiary y-axis
ax3 = ax1.twinx()
ax3.spines["right"].set_position(("outward", 60))  # move tertiary axis
ax3.plot(times, glucose, label="Glucose", marker='s', color='purple')
ax3.plot(times, weight, label="Weight", marker='d', color='brown')
ax3.set_ylabel("Glucose (mmol/L) / Weight (lbs)")

# Combine all legends
lines = ax1.get_lines() + ax2.get_lines() + ax3.get_lines()
labels = [line.get_label() for line in lines]
ax1.legend(lines, labels, loc="upper left")

plt.title("Daily Activity Combined Plot: BP, Heart Rate, Glucose, Weight")
plt.tight_layout()
plt.savefig("daily_activity_combined_plot.png")
plt.show()
