<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Health Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #2c3e50; }
    .reading { margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
    .highlight { background-color: #ffff99; transition: background-color 1s ease; }
  </style>
</head>
<body>
  <h1>ðŸ©º Health Dashboard</h1>
  <p id="last-updated">Loaded: --</p>
  
  <div id="latest-reading" class="reading">
    <p><strong>Systolic:</strong> <span id="bp-systolic">--</span></p>
    <p><strong>Diastolic:</strong> <span id="bp-diastolic">--</span></p>
    <p><strong>Pulse:</strong> <span id="bp-pulse">--</span></p>
    <p><strong>IHB:</strong> <span id="bp-ihb">--</span></p>
    <p><strong>Arm:</strong> <span id="bp-arm">--</span></p>
    <p><strong>Position:</strong> <span id="bp-position">--</span></p>
    <p><strong>Symptoms:</strong> <span id="bp-symptoms">--</span></p>
    <p><strong>Notes:</strong> <span id="bp-notes">--</span></p>
  </div>

  <script>
    const latestReadingEl = document.getElementById('latest-reading');
    const lastUpdatedEl = document.getElementById('last-updated');

    let lastData = {};

    async function fetchLatest() {
      try {
        // Add a timestamp to prevent caching
        const ts = new Date().getTime();
        const response = await fetch(`latest.json?ts=${ts}`);
        const data = await response.json();

        // Update each field
        const fields = ['systolic','diastolic','pulse','IHB','arm','position','symptoms','notes'];
        let changed = false;
        fields.forEach(f => {
          const el = document.getElementById(`bp-${f.toLowerCase()}`);
          if(el && lastData[f] !== data[f]) {
            el.textContent = data[f];
            changed = true;
          }
        });

        if(changed) {
          latestReadingEl.classList.add('highlight');
          setTimeout(() => {
            latestReadingEl.classList.remove('highlight');
          }, 1000);
        }

        const now = new Date();
        lastUpdatedEl.textContent = `Loaded: ${now.toLocaleString()}`;
        lastData = data;
      } catch(err) {
        console.error('Error fetching latest JSON:', err);
      }
    }

    // Initial fetch
    fetchLatest();
    // Fetch every 15 seconds
    setInterval(fetchLatest, 15000);
  </script>
</body>
</html>
