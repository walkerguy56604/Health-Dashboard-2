<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f4f4f4; }
  .reading-card { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; transition: background-color 1s ease; }
  .highlight { background-color: #ffff99; }
</style>
</head>
<body>

<h1>ðŸ©º Health Dashboard</h1>
<p id="loadedTime"></p>

<h2>Summary Table</h2>
<table id="summaryTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Systolic</th>
      <th>Diastolic</th>
      <th>Pulse</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Detailed Readings</h2>
<div id="readingsContainer"></div>

<script>
async function loadReadings() {
  const ts = new Date().getTime(); // cache-buster
  const response = await fetch(`latest.json?ts=${ts}`);
  const data = await response.json();

  // Sort readings newest first
  const readings = Array.isArray(data) ? data.slice().reverse() : [data];

  // Update loaded time
  document.getElementById('loadedTime').textContent = `Loaded: ${new Date().toLocaleString()}`;

  // Populate summary table
  const tableBody = document.querySelector('#summaryTable tbody');
  tableBody.innerHTML = '';
  readings.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${new Date(r.date).toLocaleString()}</td>
                    <td>${r.systolic}</td>
                    <td>${r.diastolic}</td>
                    <td>${r.pulse}</td>`;
    tableBody.appendChild(tr);
  });

  // Populate detailed readings
  const container = document.getElementById('readingsContainer');
  container.innerHTML = '';
  readings.forEach((r, index) => {
    const card = document.createElement('div');
    card.className = 'reading-card';
    card.innerHTML = `
      <strong>Date:</strong> ${new Date(r.date).toLocaleString()}<br>
      <strong>Systolic:</strong> ${r.systolic}<br>
      <strong>Diastolic:</strong> ${r.diastolic}<br>
      <strong>Pulse:</strong> ${r.pulse}<br>
      <strong>IHB:</strong> ${r.IHB}<br>
      <strong>Arm:</strong> ${r.arm}<br>
      <strong>Position:</strong> ${r.position}<br>
      <strong>Symptoms:</strong> ${r.symptoms}<br>
      <strong>Notes:</strong> ${r.notes}
    `;
    // Highlight the latest reading
    if (index === 0) {
      card.classList.add('highlight');
      setTimeout(() => card.classList.remove('highlight'), 2000);
    }
    container.appendChild(card);
  });
}

// Initial load
loadReadings();

// Optional: refresh every 20 seconds
setInterval(loadReadings, 20000);
</script>

</body>
</html>
