<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }
  tr.highlight { background-color: #ffff99; transition: background-color 1.5s ease; }
</style>
</head>
<body>
<h1>ðŸ©º Health Dashboard â€“ Full History</h1>
<table id="readings-table">
  <thead>
    <tr>
      <th>Timestamp</th>
      <th>Systolic</th>
      <th>Diastolic</th>
      <th>Pulse</th>
      <th>IHB</th>
      <th>Arm</th>
      <th>Position</th>
      <th>Symptoms</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="9">Loading readings...</td></tr>
  </tbody>
</table>

<script>
const tableBody = document.querySelector('#readings-table tbody');
const jsonFile = 'latest.json'; // make sure latest.json is in the same folder

// Format timestamp
function formatTimestamp(ts) {
    const d = new Date(ts);
    return d.toLocaleString();
}

// Keep track of last loaded reading timestamps to highlight new rows
let lastTimestamps = new Set();

async function loadReadings() {
    try {
        const response = await fetch(`${jsonFile}?ts=${Date.now()}`); // cache buster
        const data = await response.json();
        const readings = Array.isArray(data) ? data.slice().reverse() : [data];

        tableBody.innerHTML = '';
        readings.forEach(r => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${formatTimestamp(r.date)}</td>
                <td>${r.systolic}</td>
                <td>${r.diastolic}</td>
                <td>${r.pulse}</td>
                <td>${r.IHB}</td>
                <td>${r.arm}</td>
                <td>${r.position}</td>
                <td>${r.symptoms}</td>
                <td>${r.notes}</td>
            `;

            // Highlight new readings
            if (!lastTimestamps.has(r.date)) {
                tr.classList.add('highlight');
                setTimeout(() => tr.classList.remove('highlight'), 2000);
            }

            lastTimestamps.add(r.date);
            tableBody.appendChild(tr);
        });
    } catch (err) {
        tableBody.innerHTML = `<tr><td colspan="9">Error loading readings</td></tr>`;
        console.error(err);
    }
}

// Initial load
loadReadings();

// Auto-refresh every 20 seconds
setInterval(loadReadings, 20000);
</script>
</body>
</html>
