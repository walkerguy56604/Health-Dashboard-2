<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { text-align: center; }
  .reading { border: 1px solid #ccc; padding: 12px; margin-bottom: 10px; border-radius: 6px; transition: background-color 1s ease; }
  .highlight { background-color: #ffff99; }
  .timestamp { font-size: 0.85em; color: #666; }
</style>
</head>
<body>
<h1>ðŸ©º Health Dashboard</h1>
<div id="readings-container">Loading readings...</div>

<script>
const readingsContainer = document.getElementById('readings-container');
const jsonFile = 'latest.json'; // Make sure latest.json is in the same folder

// Helper to format timestamps nicely
function formatTimestamp(ts) {
    const d = new Date(ts);
    return d.toLocaleString();
}

// Fetch and display readings
async function loadReadings() {
    try {
        const response = await fetch(`${jsonFile}?ts=${Date.now()}`); // cache buster
        const data = await response.json();

        // Support both single reading and array of readings
        const readings = Array.isArray(data) ? data.slice().reverse() : [data];

        readingsContainer.innerHTML = '';
        readings.forEach((r, i) => {
            const div = document.createElement('div');
            div.className = 'reading highlight';
            div.innerHTML = `
                <div class="timestamp">Loaded: ${formatTimestamp(r.date)}</div>
                <strong>Systolic:</strong> ${r.systolic} &nbsp;
                <strong>Diastolic:</strong> ${r.diastolic} &nbsp;
                <strong>Pulse:</strong> ${r.pulse} &nbsp;
                <strong>IHB:</strong> ${r.IHB} <br>
                <strong>Arm:</strong> ${r.arm} &nbsp;
                <strong>Position:</strong> ${r.position} <br>
                <strong>Symptoms:</strong> ${r.symptoms} <br>
                <strong>Notes:</strong> ${r.notes}
            `;
            readingsContainer.appendChild(div);

            // Remove highlight after 2 seconds
            setTimeout(() => div.classList.remove('highlight'), 2000);
        });
    } catch (err) {
        readingsContainer.innerHTML = 'Error loading readings.';
        console.error(err);
    }
}

// Initial load
loadReadings();

// Optional: refresh every 20 seconds
setInterval(loadReadings, 20000);
</script>
</body>
</html>
