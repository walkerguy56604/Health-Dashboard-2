<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f9; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
  th { background: #eee; }
  .highlight { background-color: #fffa90; transition: background 1.5s ease; }
</style>
</head>
<body>

<h1>Health Dashboard</h1>
<p>Latest Readings</p>
<table id="healthTable">
  <thead>
    <tr>
      <th>Date/Time</th>
      <th>Systolic</th>
      <th>Diastolic</th>
      <th>Pulse</th>
      <th>IHB</th>
      <th>Arm</th>
      <th>Position</th>
      <th>Symptoms</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <!-- Data will populate here -->
  </tbody>
</table>

<script>
async function loadReadings() {
  try {
    const response = await fetch('latest.json?ts=' + new Date().getTime());
    const data = await response.json();

    const tableBody = document.querySelector('#healthTable tbody');
    tableBody.innerHTML = ''; // Clear existing rows

    // Support single reading or array of readings
    const readings = Array.isArray(data) ? data : [data];

    readings.forEach(reading => {
      const row = document.createElement('tr');

      Object.keys(reading).forEach(key => {
        const cell = document.createElement('td');
        cell.textContent = reading[key];
        row.appendChild(cell);
      });

      // Add highlight class for new row
      row.classList.add('highlight');
      setTimeout(() => row.classList.remove('highlight'), 1500);

      tableBody.appendChild(row);
    });
  } catch (err) {
    console.error('Failed to load readings:', err);
  }
}

// Initial load
loadReadings();

// Optional: auto-refresh every 15 seconds
setInterval(loadReadings, 15000);
</script>

</body>
</html>
