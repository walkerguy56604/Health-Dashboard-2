<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Health Dashboard</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
  th { background-color: #f0f0f0; }
  tr.latest { background-color: #d1ffd6; font-weight: bold; transition: background-color 0.5s; }
  tr.flash { background-color: #ffff99 !important; }
</style>
</head>
<body>
<h1>ðŸ©º Health Dashboard</h1>
<p id="loaded">Loaded: --</p>
<table id="bpTable">
  <thead>
    <tr>
      <th>Date</th>
      <th>Systolic</th>
      <th>Diastolic</th>
      <th>Pulse</th>
      <th>IHB</th>
      <th>Arm</th>
      <th>Position</th>
      <th>Symptoms</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const JSON_URL = 'latest.json';
let lastLatestDate = '';

async function loadData() {
  const timestamp = new Date().getTime(); // cache buster
  try {
    const response = await fetch(`${JSON_URL}?ts=${timestamp}`);
    const data = await response.json();
    const tbody = document.querySelector('#bpTable tbody');
    tbody.innerHTML = '';

    const readings = Array.isArray(data) ? data.slice().reverse() : [data];

    readings.forEach((reading, index) => {
      const tr = document.createElement('tr');
      if(index === 0) tr.classList.add('latest'); // highlight latest
      tr.innerHTML = `
        <td>${reading.date}</td>
        <td>${reading.systolic}</td>
        <td>${reading.diastolic}</td>
        <td>${reading.pulse}</td>
        <td>${reading.IHB}</td>
        <td>${reading.arm}</td>
        <td>${reading.position}</td>
        <td>${reading.symptoms}</td>
        <td>${reading.notes}</td>
      `;
      tbody.appendChild(tr);
    });

    // Flash latest reading if new
    const latestDate = readings[0]?.date;
    if(latestDate && latestDate !== lastLatestDate) {
      lastLatestDate = latestDate;
      const latestRow = tbody.querySelector('tr.latest');
      if(latestRow) {
        latestRow.classList.add('flash');
        setTimeout(() => latestRow.classList.remove('flash'), 800);
      }
    }

    document.getElementById('loaded').textContent = `Loaded: ${new Date().toLocaleString()}`;
  } catch (err) {
    console.error('Error loading JSON:', err);
  }
}

// Initial load
loadData();

// Auto-refresh every 15 seconds
setInterval(loadData, 15000);
</script>
</body>
</html>
