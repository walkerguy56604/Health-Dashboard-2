<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Health Dashboard V3</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { cursor: pointer; background-color: #eee; }
    tr.highlight { background-color: #ffff99; transition: background-color 2s ease; }
    select { margin-top: 10px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Health Dashboard V3</h1>

  <label for="filterArm">Filter by Arm:</label>
  <select id="filterArm">
    <option value="">All</option>
  </select>

  <table id="healthTable">
    <thead>
      <tr>
        <th data-key="date">Date</th>
        <th data-key="systolic">Systolic</th>
        <th data-key="diastolic">Diastolic</th>
        <th data-key="pulse">Pulse</th>
        <th data-key="IHB">IHB</th>
        <th data-key="arm">Arm</th>
        <th data-key="position">Position</th>
        <th data-key="symptoms">Symptoms</th>
        <th data-key="notes">Notes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // Embedded readings (replace or add more as needed)
    let readingsData = [
      {
        "date": "2025-12-16T11:00:00",
        "systolic": 125,
        "diastolic": 85,
        "pulse": 68,
        "IHB": "No",
        "arm": "Right",
        "position": "Sitting",
        "symptoms": "None",
        "notes": "Feeling fine"
      },
      {
        "date": "2025-12-16T12:00:00",
        "systolic": 128,
        "diastolic": 89,
        "pulse": 70,
        "IHB": "No",
        "arm": "Right",
        "position": "Sitting",
        "symptoms": "None",
        "notes": "Feeling good"
      },
      {
        "date": "2025-12-16T13:00:00",
        "systolic": 130,
        "diastolic": 88,
        "pulse": 72,
        "IHB": "No",
        "arm": "Right",
        "position": "Sitting",
        "symptoms": "None",
        "notes": "Feeling good test"
      }
    ];

    const table = document.getElementById('healthTable');
    const tbody = table.querySelector('tbody');
    const filterArm = document.getElementById('filterArm');

    // Populate filter dropdown
    const arms = [...new Set(readingsData.map(r => r.arm))];
    arms.forEach(arm => {
      const option = document.createElement('option');
      option.value = arm;
      option.textContent = arm;
      filterArm.appendChild(option);
    });

    // Display readings
    function displayReadings() {
      tbody.innerHTML = '';
      const filtered = filterArm.value ? readingsData.filter(r => r.arm === filterArm.value) : readingsData;
      filtered.forEach((r, index) => {
        const row = document.createElement('tr');
        if (index === 0) row.classList.add('highlight'); // Highlight newest
        row.innerHTML = `
          <td>${new Date(r.date).toLocaleString()}</td>
          <td>${r.systolic}</td>
          <td>${r.diastolic}</td>
          <td>${r.pulse}</td>
          <td>${r.IHB}</td>
          <td>${r.arm}</td>
          <td>${r.position}</td>
          <td>${r.symptoms}</td>
          <td>${r.notes}</td>
        `;
        if (index === 0) {
          setTimeout(() => row.classList.remove('highlight'), 3000);
        }
        tbody.appendChild(row);
      });
    }

    // Sort table when clicking headers
    table.querySelectorAll('th').forEach((th) => {
      th.addEventListener('click', () => {
        const key = th.dataset.key;
        readingsData.sort((a, b) => {
          if (key === 'date') return new Date(b.date) - new Date(a.date);
          return (b[key] || '').toString().localeCompare((a[key] || '').toString(), undefined, { numeric: true });
        });
        displayReadings();
      });
    });

    // Filter by arm
    filterArm.addEventListener('change', displayReadings);

    // Initial display
    displayReadings();
  </script>
</body>
</html>
